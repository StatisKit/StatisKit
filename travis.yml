language: cpp

os:
  - linux
  - osx

env:
    # - RECIPE=gmp
    # - RECIPE=mpfr
    # - RECIPE=mpc
    # - RECIPE=isl 
    # - RECIPE=binutils 
    # - RECIPE=glibc 
    # - RECIPE=gcc 
    # - RECIPE=libgcc 
    - RECIPE=clang 
    - RECIPE=cpp-build 
    - RECIPE=cpp-run
    - RECIPE=python-scons
    - RECIPE=py-build
    - RECIPE=py-run
    - RECIPE=libboost

# matrix:
#     include:
#         -   os: linux
#             dist: trusty
#             sudo: required
#             compiler: gcc
#             addons:
#                 apt:
#                     sources:
#                         - ubuntu-toolchain-r-test
#                     packages:
#                         - g++-5
#             env:
#                 - COMPILER=g++-5
#         -   os: osx
#             osx_image: xcode7.3

install:
    - git clone https://gist.github.com/319558c83d145620a6d4decdcadfbfb0.git config-travis
    - cd config-travis
    - source config.sh
    - cd ..
    - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
       sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test;
       sudo apt-get install -qq g++-5;
       sudo update-alternatives --remove-all gcc;
       sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 20
       sudo update-alternatives --config gcc
      fi

script:
    - cd conda
    - conda build $RECIPE -c statiskit -c conda-forge

after_success:
    # -   export ANACONDA_UPLOAD_FLAGS="--force"
    -   if [[ ! "$ANACONDA_BUILD_RECIPES" = "" ]] && [[ "$TRAVIS_BRANCH" = "master" ]] && [[ "$TRAVIS_PULL_REQUEST" = "false" ]] && [[ ! -z $ANACONDA_USERNAME ]]; then
            cd conda;
            bash upload.sh;
            cd ..;
        fi
    -   if [[ "$ANACONDA_BUILD_RECIPES" = "" ]] && [[ "$TRAVIS_BRANCH" = "master" ]] && [[ "$TRAVIS_PULL_REQUEST" = "false" ]] && [[ "$TRAVIS_OS_NAME" = "linux" ]] && [[ ! -z $DOCKER_USERNAME ]]; then
            cd docker;
            bash upload.sh;
            cd ..;
        fi
